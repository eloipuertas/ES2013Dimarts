(function(e){function t(t,n){function g(){r.update();b();return r}function y(){var e=h.toLowerCase();f.obj.css(c,p/u.ratio);o.obj.css(c,-p);v.start=f.obj.offset()[c];u.obj.css(e,a[n.axis]);a.obj.css(e,a[n.axis]);f.obj.css(e,f[n.axis])}function b(){if(!m){f.obj.bind("mousedown",w);a.obj.bind("mouseup",S)}else{s.obj[0].ontouchstart=function(e){if(1===e.touches.length){w(e.touches[0]);e.stopPropagation()}}}if(n.scroll&&window.addEventListener){i[0].addEventListener("DOMMouseScroll",E,false);i[0].addEventListener("mousewheel",E,false)}else if(n.scroll){i[0].onmousewheel=E}}function w(t){t.preventDefault();var n=parseInt(f.obj.css(c),10);v.start=l?t.pageX:t.pageY;d.start=n=="auto"?0:n;if(!m){e(document).bind("mousemove",S);e(document).bind("mouseup",x);f.obj.bind("mouseup",x)}else{document.ontouchmove=function(e){e.preventDefault();S(e.touches[0])};document.ontouchend=x}}function E(t){if(o.ratio<1){var r=t||window.event,i=r.wheelDelta?r.wheelDelta/120:-r.detail/3;p-=i*n.wheel;p=Math.min(o[n.axis]-s[n.axis],Math.max(0,p));f.obj.css(c,p/u.ratio);o.obj.css(c,-p);if(n.lockscroll||p!==o[n.axis]-s[n.axis]&&p!==0){r=e.event.fix(r);r.preventDefault()}}}function S(e){if(o.ratio<1){if(!m){d.now=Math.min(a[n.axis]-f[n.axis],Math.max(0,d.start+((l?e.pageX:e.pageY)-v.start)))}else{d.now=Math.min(a[n.axis]-f[n.axis],Math.max(0,d.start+(v.start-(l?e.pageX:e.pageY))))}p=d.now*u.ratio;o.obj.css(c,-p);f.obj.css(c,d.now)}}function x(){e(document).unbind("mousemove",S);e(document).unbind("mouseup",x);f.obj.unbind("mouseup",x);document.ontouchmove=document.ontouchend=null}var r=this,i=t,s={obj:e(".viewport",t)},o={obj:e(".overview",t)},u={obj:e(".scrollbar",t)},a={obj:e(".track",u.obj)},f={obj:e(".thumb",u.obj)},l=n.axis==="x",c=l?"left":"top",h=l?"Width":"Height",p=0,d={start:0,now:0},v={},m="ontouchstart"in document.documentElement?true:false;this.update=function(e){s[n.axis]=s.obj[0]["offset"+h];o[n.axis]=o.obj[0]["scroll"+h];o.ratio=s[n.axis]/o[n.axis];u.obj.toggleClass("disable",o.ratio>=1);a[n.axis]=n.size==="auto"?s[n.axis]:n.size;f[n.axis]=Math.min(a[n.axis],Math.max(0,n.sizethumb==="auto"?a[n.axis]*o.ratio:n.sizethumb));u.ratio=n.sizethumb==="auto"?o[n.axis]/a[n.axis]:(o[n.axis]-s[n.axis])/(a[n.axis]-f[n.axis]);p=e==="relative"&&o.ratio<=1?Math.min(o[n.axis]-s[n.axis],Math.max(0,p)):0;p=e==="bottom"&&o.ratio<=1?o[n.axis]-s[n.axis]:isNaN(parseInt(e,10))?p:parseInt(e,10);y()};return g()}e.tiny=e.tiny||{};e.tiny.scrollbar={options:{axis:"y",wheel:40,scroll:true,lockscroll:true,size:"auto",sizethumb:"auto"}};e.fn.tinyscrollbar=function(n){var r=e.extend({},e.tiny.scrollbar.options,n);this.each(function(){e(this).data("tsb",new t(e(this),r))});return this};e.fn.tinyscrollbar_update=function(t){return e(this).data("tsb").update(t)}})(jQuery)